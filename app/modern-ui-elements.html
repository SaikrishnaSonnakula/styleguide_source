<!DOCTYPE html>
<html lang="en">
  <head>
    <title>UI elements with Javascript</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <script src="modern.bundle.js"></script>

    <meta charset="UTF-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
  </head>
  <body>
    <a href="/">
      <header class="styleguide-header">
        <span id="menu-button" class="device-menu-button icon-menu"></span>
        <span class="desktop-only">Web Design</span> Styleguide
      </header>
    </a>
    <div class="current-breakpoint">
      Current Breakpoint:
      <span class="mobile-only">Mobile</span>
      <span class="tablet-only">Tablet</span>
      <span class="small-desktop-only">Small Desktop</span>
      <span class="desktop-only">Desktop Medium</span>
      <span class="large-desktop-only">Large Desktop</span>
    </div>

    <main class="styleguide-main" style="display: none">
      <nav id="navbar" class="styleguide-navigation fixedsticky hidden">
        <ul>
          <li><a href="#accordion">Accordion</a></li>
          <li><a href="#dropdown">Dropdown</a></li>
        </ul>
      </nav>

      <article class="styleguide-content">
        <section id="about-section">
          <h2 class="styleguide-section-heading">
            READ ME FIRST
          </h2>
          <p class="fuchsia" style="padding: 15px;">ATTENTION: <br />
            The following patterns are experimental & subject to change.<br />
            If you find any issues with them, please contribute to fix them.
          </p>
          <p>The patterns on this page are ochestrated with javascript to fully function.</p>
        </section>

        <section id="accordion">
          <h2 class="styleguide-section-heading">Accordion</h2>
          <div class="example -padded">
            <pre class="code language-javascript">
              import accordion from 'styleguide/lib/modern/scripts/accordion';

              accordion($("#hipstaccordion"));
            </pre>
            <div id="hipstaccordion" class="accordion" role="tablist">
              <div class="-group">
                <div class="-heading" role="tab">
                  <h3 class="item-heading">Fanny Pack Four Dollar Toast</h3>
                  <p class="auxiliary-text">Blue Bottle Sriracha</p>
                </div>
                <div class="-content" role="tabpanel" aria-expanded="false" aria-hidden="true">
                  <h4 class="item-subheading">Cliche Flannel Tweet</h4>
                  <p class="auxiliary-text">Brunch offal bushwick chambray biodiesel pitchfork
                  slow-carb vice chicharrones lomo paleo. Tacos offal chicharrones craft beer, fanny pack lo-fi yr meditation wayfarers pug bicycle rights.
                  Occupy pop-up ennui, portland retro street art banjo kogi shabby chic 3 wolf moon. Crucifix echo park bespoke, ugh shoreditch semiotics neutra austin PBR&B etsy hella occupy.
                  Banjo gentrify pop-up, kombucha poutine salvia quinoa shoreditch organic chambray art party ramps.</p>
                </div>
              </div>
              <div class="-group">
                <div class="-heading" role="tab">
                  <h3 class="item-heading">Kombucha Church-Key Listicle</h3>
                  <p class="auxiliary-text">Disrupt Waistcoat Marfa</p>
                </div>
                <div class="-content" role="tabpanel" aria-expanded="false" aria-hidden="true">
                  <h4 class="item-subheading">Pour-over Wolf VHS Helvetica</h4>
                  <p class="auxiliary-text">Kitsch keytar tacos hammock XOXO, austin meggings gentrify hoodie art party 3 wolf moon gochujang.
                  Kombucha church-key listicle, typewriter forage mixtape locavore fingerstache synth you probably haven't heard of them leggings next level.</p>
                </div>
              </div>
            </div>
          </div>
        </section>

      <section id="dropdown">
        <h2 class="styleguide-section-heading">
          Dropdown
        </h2>
        <p>
        Dropdown that contains a list of links used for navigation.
        </p>
          <pre><code class="language-javascript">
import $ from 'jquery';
const dropdownButtonSelector = '.-value';
const currentSelectedOption = '.current-selection';
const optionListSelector = '.-options li';
const dropdownOpenClass = '-open';
const activeOptionClass = '-active';
const ENTER_KEY = 13;

const setupDropdown = (element) => {
  const dropdownButton = $(dropdownButtonSelector, element);
  const optionList = $(optionListSelector, element);
  const lastOptionIndex = optionList.length - 1;

  let currentOptionIndex = 0;
  let selectedOption = optionList[0];
  let focusedOption;

  const toggleDropdown = (focusElement) => {
    $(element).toggleClass(dropdownOpenClass);

    if(!isDropdownOpen()) {
      dropdownButton.attr('aria-expanded', false);
      $('ul', element).attr('aria-hidden', true);
      focusOn(focusElement);
    } else {
      dropdownButton.attr('aria-expanded', true);
      $('ul', element).attr('aria-hidden', false);
    }
  };

  const setActiveOption = () =>  {
    $(optionListSelector, element).each((index, option) => {
      const optionLink = $('a', option);

      if (option === selectedOption) {
        optionLink.attr('aria-selected', true);
        optionLink.attr('aria-checked', true);
        $(option).addClass(activeOptionClass);
      } else {
        optionLink.attr('aria-selected', false);
        optionLink.attr('aria-checked', false);
        $(option).removeClass(activeOptionClass);
      }
    });
  };

  const select = (option) => {
    selectedOption = option;
    $(currentSelectedOption, element).text($(option).text());
    setActiveOption();
    toggleDropdown(dropdownButton);
  };

  const focusOn = (optionToFocusOn) => {
    $(optionToFocusOn).focus();
  };

  const isDropdownOpen = () => {
    return $(element).hasClass(dropdownOpenClass);
  };

  const handleUpKey = () => {
    let isOnFirstOption = currentOptionIndex === 0;
    let prevOptionIndex = isOnFirstOption ? lastOptionIndex : currentOptionIndex - 1;

    handleArrowKey(prevOptionIndex);
  };

  const handleDownKey = () => {
    let isOnLastOption = currentOptionIndex === lastOptionIndex;
    let nextOptionIndex = isOnLastOption ? 0 : currentOptionIndex + 1;

    handleArrowKey(nextOptionIndex);
  };

  const handleArrowKey = (newOptionIndex) => {
    focusedOption = optionList[newOptionIndex];
    currentOptionIndex = newOptionIndex;
    focusOn($('a', optionList[newOptionIndex]));
  };

  const handleSpace = () => {
    select(optionList[currentOptionIndex]);
  };

  const handleCloseKeys = () => {
    toggleDropdown(dropdownButton);
  };

  const KEY_HANDLERS = {
    40: handleDownKey,
    38: handleUpKey,
    32: handleSpace,
    27: handleCloseKeys, //Escape Key Handler
    9: handleCloseKeys   //Tab Key Handler
  };

  optionList.each((index, option) => {
    $(option).attr('role', 'presentation');
    $('a', option).attr('role', 'option');

    $('a', option).on('click keydown', ($event) => {
      if(!$event.keyCode || $event.keyCode === ENTER_KEY) {
        const optionSelected = $event.target.parentElement;
        $event.preventDefault();

        select(optionSelected);
      }
    });
  });

  dropdownButton.on('click', () => {
    toggleDropdown(dropdownButton);

    if(isDropdownOpen()){
      currentOptionIndex = 0;
      focusedOption = optionList[0];
      focusOn($('a', focusedOption));
    }
  });

  $(element).on('keydown', ($event) => {
    const keyCode = $event.keyCode;

    if(isDropdownOpen() && KEY_HANDLERS[keyCode]){
      $event.preventDefault();

      KEY_HANDLERS[keyCode]();
    };
  });

  $(document).on('click', ($event) => {
    let target = $event.target;
    if($(element).has(target).length <= 0 && isDropdownOpen()){
      toggleDropdown(target);
    }
  });
};

$(document).ready(() => {
  setTimeout(() => {
    $('.dropdown').each((index, dropdown) => {
      setupDropdown(dropdown);
    });
  }, 2000);
});
          </code></pre>
        <div class="example -padded-desktop">
          <div id="best-nba-team" class="dropdown">
            <button class="-value" aria-expanded="false">
              <div class="current-selection">Golden State Warriors</div>
            </button>
            <ul class="-options" aria-hidden="true" role="listbox" aria-label="NBA Options">
              <li role="presentation" class="-active"><a role="option" aria-checked="true" aria-selected="true" href="#warriors">Golden State Warriors</a></li>
              <li role="presentation"><a role="option" aria-checked="false" aria-selected="false" href="#lakers">LA Lakers</a></li>
              <li role="presentation"><a role="option" aria-checked="false" aria-selected="false" href="#clippers">LA Clippers</a></li>
            </ul>
          </div>
        </div>

        <p>
        Add <code>.-form</code> to the dropdown to style it as the main dropdown used on the top of many features.
        </p>

        <div class="example -padded-desktop">
          <div id="neighborhood" class="dropdown -form">
            <button class="-value" aria-expanded="false">
              <div class="current-selection">San Francisco</div>
            </button>
            <ul class="-options" aria-hidden="true" role="listbox">
              <li role="presentation"><a role="option" aria-checked="false" aria-selected="false" href="#mission">Mission</a></li>
              <li role="presentation"><a role="option" aria-checked="false" aria-selected="false" href="#haight">Haight</a></li>
              <li role="presentation"><a role="option" aria-checked="false" aria-selected="false" href="#nob-hill">Nob Hill</a></li>
            </ul>
          </div>
        </div>
      </section>
      </article>
    </main>
  </body>
</html>
